# 汎用タスク実行AIエージェント 要件定義書 v1.0

作成日：2025-12-05
作成者：＿＿＿

---

## 1. システム概要

ユーザーが自然言語で指示すると、
エージェントが自律的に思考し、必要に応じて **RAG（ドキュメント検索）を判断的に利用**して回答を生成する Web アプリケーション。

---

## 2. プロジェクト目的

* タスク内容に基づき、
  「LLMのみ」 or 「RAG利用」の **自動判断ができるエージェント**を実装する。
* 将来的には複数ツールを追加し、より**自律的な実行主体**へ発展させる。

---

## 3. スコープ（ゴール）

* G-01：タスクの理解（質問の意図分類）
* G-02：RAG利用が適切な場面を判断し、自動適用
* G-03：推論過程（思考プロセス）を可視化
* G-04：単一質問ごとのステート管理（過去メモリは不要）

---

## 4. 非スコープ（今回対象外）

* Web検索や計算ツールの導入
* 長期メモリ（会話履歴の保持）
* 高権限操作（ファイル操作、SNS投稿など）

---

## 5. 機能要件（Functional Requirements）

### 5.1 入出力

| ID   | 機能        | 詳細                           |
| ---- | --------- | ---------------------------- |
| F-01 | 問い合わせ入力機能 | ユーザーはテキスト入力欄から指示を送信できる       |
| F-02 | 回答生成機能    | LLMにより自然文回答を返す               |
| F-03 | RAG判断機能   | 手元ドキュメント依存の場合のみ RAG を実行      |
| F-04 | RAG実行結果統合 | RAGチャンクを踏まえて推論結果を最終回答へ統合     |
| F-05 | 思考ログ可視化   | 実行ステップ（推論意図、ツール利用履歴）をフロントへ返却 |

---

## 6. 思考ログの仕様

あなたの指定：

> 「詳細」ログ表示（推論の流れあり）

例：

* Step1: 質問意図解析 → ドキュメント依存と判断
* Step2: RAG 実行
* Step3: 要点抽出
* Step4: 推論統合して回答

※ ただし **内部CoTは短く要約**し、機密を守る書き方に制御する

---

## 7. RAG利用判断基準（v1.0）

| 種類            | 判定     | 処理         |
| ------------- | ------ | ---------- |
| 文書の内容を前提とする質問 | 文書依存判定 | RAG → 回答統合 |
| 一般知識・推論で解決    | 非文書依存  | LLMのみ      |
| 曖昧（どちらとも取れる）  | Hybrid | RAG実行後推論補完 |

※ 初期判定は LLM に委譲 → プロンプト設計で制御

---

## 8. システム構成

既存 RAG バックエンドを改良し **エージェントAPIを追加**

```
User → Frontend(React)
   → Backend(FastAPI)
      → Agent(LangChain or LangGraph)
         → RAGツール（内部呼び出し）
```

---

## 9. API仕様

### 9.1 エージェントAPI

| 項目      | 内容                                    |
| ------- | ------------------------------------- |
| メソッド    | POST                                  |
| エンドポイント | `/api/agent/ask`                      |
| リクエスト   | `{ "input": "..." }`                  |
| レスポンス   | `{ "output": "...", "steps": [...] }` |

---

## 10. 非機能要件（NFR）

| ID     | 項目    | 内容            |
| ------ | ----- | ------------- |
| NFR-01 | 応答速度  | 1タスク15秒以内を目安  |
| NFR-02 | コスト制御 | トークン使用量を適切に制限 |
| NFR-03 | 安全性   | 推測や不足情報を明示する  |

---

## 11. 段階的ロードマップ

| フェーズ   | 内容                  |
| ------ | ------------------- |
| Phase1 | RAG判断エージェント（今回の目標）  |
| Phase2 | 計算ツール、Web検索など拡張     |
| Phase3 | セッションメモリ + 複数ツール最適化 |

---

以上
最小構成エージェントをしっかり作りきることをゴールとする。
